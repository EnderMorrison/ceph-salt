{% set host = salt['config.get']('host') -%}
{% set rabbitmq_interface = salt['pillar.get']('sensu:server:rabbitmq:interface') -%}
{% set grains = salt['mine.get']('roles:sensu-server','grains.items','grain') -%}

{
  "rabbitmq" : {
    "host" : "{{ grains[host]['ip_interfaces'][rabbitmq_interface][0] }}",
    "port" : 5672,
    "user" : "{{ salt['pillar.get']('sensu:server:rabbitmq:user') }}",
    "password" : "{{ salt['pillar.get']('sensu:server:rabbitmq:password') }}",
    "vhost" : "{{ salt['pillar.get']('sensu:server:rabbitmq:vhost') }}"
  }
}
